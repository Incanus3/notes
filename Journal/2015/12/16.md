=== Wed, 16.12. ===

- 2-2.45    - objednavky (hajek) - finalizace registrace s overenim dokladu
- 2.45-3.30 - makro - neodesilaji se kopie potvrzovacich mailu
- 3.30-8.30 - objednavky (hajek) - finalizace registrace s overenim dokladu
- 9.30-12   - makro - omezeni ruseni objednavek s expirovanymi udalostmi
  - srani s js - turbolinks - udalosti se nenavazou, nebo se navazou opakovane, chova se jinak v
    developmentu a v productionu

= 9h

- debug podivne chyby v testech:
expect(result).to be_kind_of(ClientFinder::FoundMoreThanOneNotRegistered) pri selhani kind_of preda
tridu RSpec::Support::ObjectFormatter.format pro vytisteni failure message, ten ale na tridu
(definovanou pomoci FailureObject) vola Array() -> to_ary, coz obslouzi method_missing tridy, tudiz nehodilo
NoMethodError, coz zmatlo volani Array

- alto-base-utils
  improved method_missing included into result object classes
  - defines constant method only if given exactly 1 positional argument

  instead of overriding method_missing in classes defined by Result subclasses, use constant_method to
  define methods returning constant results

- alto-rails-auth
  fixed CreateClientForm after changing alto-base-utils/result_objects
  updated dependencies

  registrations#create sets flash in #registration_failed - may be overridden

  client already registered case is now handled by CreateClientForm#find_client, not #set_up_client

  updated CreateClientForm failure messages

- objednavky
  simplified ClientFinder#find_for_registration
  - when some unregistered clients were found for given card and none has given email, returns
    FoundSomeButEmailsDiffer without respect to their count or their transactions
  - controller handles this by allowing user to verify himself by bill
  - fixed test suite
  fixed result objects after changing alto-base-utils/result_objects
  - updated alto-base-utils and alto-rails-auth
  extracted specs for ChainSpecificClientScopes

  result message and links to solutions are shown in one alert box
  - updated alto-rails-auth
  - RegistrationHelper obsoleted by RegistrationResultDecorator
  - RegistrationsController#registratoin_failed only sets @result
  - all logic around error message contents is in RegistratoinResultDecorator

  enhanced registration - more instructions on failures
  - updated alto-rails-auth
  - added instructions to verify input, try to log in or try later
  - ClientFinder#find_for_registration returns AllAreRegistered in case when client with given card
    number and email is found, but is registered - success client is never registered
  - fixed spec

- rezervace
  limited order reversals on event expiration
  - orders with any expired events can't be completely reversed
  - orders with all expired events can't be even partially reversed
  - disabled inputs for expired event registrations on partial reversal page
  fixed order_history js loading

  fixed Order#completely_expired?
  - returned true for order with no registrations, but #expired? returned false
  simplified order expiration logic
  - added Registration.expired, .not_expired and #expired?, ReversalRegistration#not_expired?
  - used in Order#expired? and #completely_expired?
  - used in partial reversal view
  optimized - used exists? instead of any? and none?

  reverted order_history.coffee loading change
