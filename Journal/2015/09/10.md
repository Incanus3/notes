=== Thu, 10.9. ===

- 11.15-1.15 - rezervace
  ReversalRegistration now takes existing reversals into consideration
  - updated #original_count and #original_price
  OrderReversals.partial handles AlreadyCompletelyReversed case
  moved most of model logic from OrderReversals service
  - added Registration#reversed_count, #remaining_count and #completely_reversed?
  - added Order#completely_reversed?
  updated specs
  removed old notes, added some todos

  prepared for unifying complete and partial reversal logic
  - OrderReversal.complete - made the fact that we're working with plain_reversal_order explicit
  - simplified bill generation for partial reversal

- 2.45-9.45
  greatly simplified OrderReversals service
  - unified complete and partial reversal logic
  - extracted common behavior
  - no longer has knowledge about reversal registration storage (doesn't work with plain reversal
    registrations)
  - fixed bug - for complete reversal, mailer was passed the original order

  renamed PartialReversalOrder to OpenReversalOrder since it's used for both complete and partial
  reversals now

  ReversalRegistration#save now checks new_count ...
  - fails when > original_count
  - fails when < 0
  - added #save!, used everywhere
  - tested

  updated OrdersController and PaymentsController after service changes ...
  - using OrderReversals service instead of Orders
  - using Order#open_reversal_order
  - renamed PartialReversalOrderDecorator to OpenReversalOrderDecorator
  fixed all specs but one - link to reversal order from cancellation bill

  moved order reversal actions from PaymentsController and OrdersController to separate ...
  OrderReversalsController
  - updated routes
  - updated views

  extracted PaymentErrorMessages from PaymentsController ...
  removed duplicates in OrderReversalsController

  cleaned up ...
  - added bang to PaymentErrorMessages#unhandled_failure, since it raises
  - extracted PaymentsController#payment_failure
  - removed unneeded OpenReversalOrder.for and ReversalRegistration.for constructors

  fixed last spec - cancellation bill is linked to reversal, not original order ...
  Bills::Success now holds bill or bill update

  showing reversed orders to privileged users ...
  - refactored OrdersController

  handled OrderReversals::AlreadyCompletelyReversed ...
  in order_reversals#complete, #init_partial and #confirm_partial
  OrderReversals::NothingChanged now returns client to reversal form
  fixed scoping of orders for history index
  fixed require for OrderReversals service

  fixed orders#index when no client selected

= 9h
