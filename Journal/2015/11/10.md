=== Tue, 10.11. ===

- 2-6 - studium elasticsearch

- 6.30-9.30 - objednavky - sepsani blabolu

- 10-12 - studium elasticsearch

= 9h

==== Blabol ====
=== Objednavky ===

== entity ==
- jidelna (Canteen) - vydejna objednaneho jidla (Meal)
- jidlo   (Meal)
- retezec (Chain)   - subjekt nadrazeny jidelnam; jidelna patri prave jednomu retezci
- klient  (Client)  - stravnik konzumujici jidla v jidelnach
  - klient muze mit libovolny pocet vztahu s retezci (ClientChain), tyto vztahy mohou byt dvou typu - politiky
    poctu porci (ClientChain::PortionsPolicy, PP, viz objednavka)
  - klient ma skrze retezce neprime vztahy s jidelnami (ClientCanteenRelation) - PP udana typem
    vztahu s nadrazenym retezcem
- uzivatel (User) - ucet, skrze ktery se klient prihlasuje do webove aplikace
  - klient neni pri vzniku (import seznamu poskytovaneho retezcem) asociovan s zadnym uzivatelskym
    uctem, pro vytvoreni uzivatelskeho uctu se klient musi bud zaregistrovat, nebo je mu vytvoren
    automatickym skriptem (rake db:create_users_for_clients - vytvori uzivatele s nahodnymi hesly
    - pro prihlaseni do webove aplikace heslem je treba nejprve provest reset hesla)
  - pri vytvareni klienta v administraci lze zvolit automaticke vytvoreni uzivatele asociovaneho
    s novym klientem
  - krome klientskych uctu, existuje jeste druha varianta - ucet administrativni
  - administrator neni asociovan s zadnym klientem, po prihlaseni nema pristup ke klientske casti
    rozhrani, ma ale pristup do administrace, kde muze editovat vsechny entity v databazi
    (vytvaret, upravovat, mazat)
- objednavka (Order)
  - patri klientu
  - nese informaci o objednanych jidlech a jejich mnozstvich
  - v zavislosti na PP vztahu klienta s jidelnou muze klient objednat bud prave jednu porci od
    kazdeho chodu, nebo libovolny pocet potencialne ruznych jidel od kazdeho chodu
  - jidelna ma nastaveny deadline objednavek pro kazdy chod (relativne vzhledem k pulnoci po dni
    jeho vydavani)
- menu (Menu, CourseMenu) - nabidka jidel v dane jidelne, na dany den (Menu) a pripadne chod
  (CourseMenu)

- jidelny, jidla, klienti a menu vznikaji zapisem do databazoveho API (datastore)
- uzivatele vznikaji registraci
- objednavky vznikaji v okamziku prvniho objednani daneho chodu
- vsechny entity (a jejich vztahy) lze take editovat v administracni casti rozhrani

== prihlasovani ==
- registrace
  - pri registraci klient zadava sve osobni udaje (ruzne retezce zobrazuji a vyzaduji ruzna pole
    s osobnimi udaji) spolu s cislem sve klientske karty (v ramci retezce) a prihlasovacimi udaji
    (email a volitelne heslo - voli retezec)
  - je-li klient pomoci cisla karty nalezen v databazi, aktualizuji se jeho osobni udaje, pote je
    vytvoren novy uzivatelsky ucet (se zadanymi prihlasovacimi udaji) a asociovan s klientem
  - nasledne je klientovi zaslan aktivacni email slouzici k potvrzeni pristupu klienta k teto
    schrance
  - pokud klient aktivacni email neobdrzel, smazal, nebo jej nevyuzil v casovem limitu, muze
    vyzadat zaslani noveho (Registrovat/Prihlasit -> 'Nedostal jste aktivacni email?')
  - prihlaseni je mozno az po uspesnem potvrzeni emailove adresy (kliknutim na odkaz v aktivacnim
    emailu)
- prihlaseni - po registraci nebo jinem vytvoreni uzivatelskeho uctu (skript, administrace) je
  mozno prihlasit se do webove aplikace
  - aplikace nabizi nekolik ruznych variant prihlasovani
    - zakladni prihlaseni emailem a heslem
    - prihlaseni cislem karty spolu s jednim dalsim udajem - heslo ci email
  - pri zapomenuti prihlasovaciho hesla, nebo po vytvoreni uzivatele automatickym skryptem, je
    mozno vyzadat jeho resetovani (Prihlaseni -> 'Zapomel jste heslo?')
  - po opakovanem zadani spatneho prihlasovaciho hesla je uzivatelsky ucet blokovan a klientovi je
    zaslan odblokovaci email (s odkazem)
  - pri jeho ztrate lze opet vyzadat (Prihlaseni/Registrace -> 'Nedostal jste instrukce k
    odblokovani uctu?')
- po uspesnem prihlaseni muze klient editovat sve osobni a prihlasovaci udaje (editace profilu),
  zmena emailu vyzaduje jeho nove potvrzeni

== klientske rozhrani ==
- objednavani (deadliny), historie objednavek, historie transakci, ziskani zustatku (nevyzaduje
  prihlaseni)

- sekce 'Denní menu' umožňuje přihlášenému klientovi objednání jídel v rámci daných chodů
  - klient vybírá
    - jídelnu (vpravo) v ramci řetězců, s nimiž má vztahy
    - datum (nahoře)
    - v závislosti na PP vztahu s řetězcem, jehož jídelnu klient zvolil, vybírá klient buď jedno
      jídlo v rámci chodu, nebo počet porcí od každého nabízeného jídla
  - je-li po deadline objednávek daného chodu, ovládací prvky jeho formuláře jsou deaktivovány
- sekce 'Historie objednávek' a 'Historie transakcí' slouží k přehledu klienta o minulých
  objednávkách jídel (a jejich konzumaci) a finančních či bodových transakcích
  - tabulky s objednávkami/transakcemi lze různě řadit a filtrovat

- poslední součástí klientské části webové aplikace je formulář pro zjištění zůstatku klienta
  - přístup k tomuto formuláři nevyžaduje přihlášení a z rozhraní aplikace na něj nevede žádný
    odkaz
  - formulář je určen k vložení do jiné webové stránky pomoci iframe, nebo podobné technologie

== administrace ==
- urovne opravneni

- deployment - datastore, migrace, nastaveni

[ ] poslat kyzourovi seznam precislovanych uctu
[ ] nastavit automaticke zalohovani databazi
[ ] logstash
