=== Mon, 20.6. ===

- 9-1, 2-4
  - kancl
    - reseni orderman kasy s evzou a petkou
    - studium http://devdoc.easy.om7.at/
- 8.30-9.30 - -||-
- 10-10.30 - hajek - mazani karet v rozsahu card_ids

- PostgreSQL - safe conversion of a string to number ignoring non-digit chars:
  coalesce(nullif(regexp_replace('abc123def', '[^\d]', '', 'g'), ''), '0')::int

# number of clients with given card numbers
with extended_clients as (
  select *, coalesce(nullif(regexp_replace(card_id, '[^\d]', '', 'g'), ''), '0')::int as card_number from clients
) select count(id) from extended_clients
  where card_number >= 319001 and card_number <= 319496

# array of card_ids of clients with given card numbers
with card_numbers as (
  select client_id, coalesce(nullif(regexp_replace(card_id, '[^\d]', '', 'g'), ''), '0')::int as card_number from clients
) select array_agg(card_id order by card_id) from card_numbers
  where card_number >= 319001 and card_number <= 319496

# ensure that array of ids selected by coercing and filtering card_ids is the same as
#             array of ids selected by coercing and filtering client_ids
with card_numbers as (
  select id, card_id, coalesce(nullif(regexp_replace(card_id, '[^\d]', '', 'g'), ''), '0')::int as card_number from clients
), client_numbers as (
  select id, client_id, coalesce(nullif(regexp_replace(client_id, '[^\d]', '', 'g'), ''), '0')::int as client_number from clients
), selected_by_card_id as (
  select id from card_numbers where card_number >= 319001 and card_number <= 319496
), selected_by_client_id as (
  select id from client_numbers where client_number >= 319001 and card_number <= 319496
)
  select array_agg(id order by id) from selected_by_card_id = array_agg(id order by id) from selected_by_client_id

with card_numbers as (
  select id, coalesce(nullif(regexp_replace(card_id, '[^\d]', '', 'g'), ''), '0')::int as card_number from clients
) delete from clients where id in (select id from card_numbers where card_number >= 319001 and card_number <= 319496)
