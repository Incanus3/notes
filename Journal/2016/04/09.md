=== Sat, 9.4. ===

- 17-21
  - preload kolekce udalosti spolu s volnymi kapacitami
    - instance method overrides the one returning the computed column
  - priprava na testovani databazove efektivity kodu
    - pridan LoggingHelper - presmerovani rails a AR logu na vystup
    - pridan EventListener - snadne odebirani ActiveSupport::Notifications
    - pridan QueryCollector
      - dedi z EventListeneru
      - sbira a uklada provedene databazove dotazy (v prubehu subscribu)

SELECT id, name, capacity, registered_count, capacity - registered_count AS free_capacity
FROM events JOIN (SELECT event_id, SUM(count) AS registered_count
                  FROM registrations GROUP BY event_id) registered_counts
ON events.id = registered_counts.event_id

OR

WITH registered_counts AS
  (SELECT event_id, sum(count) AS registered_count FROM registrations GROUP BY event_id)
SELECT id, name, capacity, registered_count, capacity - registered_count AS free_capacity
FROM events JOIN registered_counts ON events.id = registered_counts.event_id)
