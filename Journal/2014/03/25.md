=== Tue, 25.3. ===

- prace - alto
  - 4.30-6
    - extracted CapybaraHelpers::CanteenSelection and shared context client_user
      from canteen selection spec (simplified)
    - prepared failing spec for saving canteen selection between sessions and
      clearing it if the relation no longer exists

    - stored relation is now cleared during log-in if the relation no longer
      exists
    - relation is now saved in cookies instead of in session, so it persists
      between sessions

    - added failing spec for correct redirection after login when session expired

  - 6.15-7.45
    - simulace expirace devise session

  - 8.30-9.30
    - client is now redirected to menu after log-in
    - admin is now redirected to administration after log-in
    - when user can't access page, he's redirected to root with alert
    - ClientAuth#current_canteen and #current_policy return nil when
      current_relation returns nil
    - MenusController redirects to root with alert if client has no canteen
      relation
    - finished testing of after-log-in redirections
  = 4h

=== Capybara ===
- k requestu se lze dostat pomoci Capybara.current_session.driver.request
- warden je v request.env['warden'], taky lze pres controller.warden
- ve warden.session(:user)['last_request_at'] je ulozen cas posledni aktivity,
  podle nej se rozhoduje timeout session; nastaveni na 1.hour.ago.utc ale
  nestaci
- expiraci lze simulovat nastavenim
  Devise.setup { |c| c.timeout_in = 0.seconds }
- je ale treba vratit zpet pred opetovnym loginem

https://github.com/plataformatec/devise/blob/master/lib/devise/models/timeoutable.rb
https://github.com/plataformatec/devise/blob/master/lib/devise/hooks/timeoutable.rb

=== ActiveRecord ===
scope :at, proc { |canteen| where(canteen: canteen) }
- rve, ze nezna sloupec canteen, pokud je canteen nil - udela podminku
  jidelak.canteen = NULL misto jidelak.firma_key = NULL, prestoze je definovano
  belongs_to :canteen, foreign_key: 'firma_key'
