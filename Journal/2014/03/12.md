=== Wed, 12.3. ===

- prace - fs
  - 2-3 - studium rake, capistrano (+ cap/rails, bundler, rvm)
  - 4-6 - -||-
  - 7-8 - vytvoreni testovaci rails aplikace pro capistrano
  - 8.15-10.45 - nasazeni capistranem
  - 11-12
    - spousteni aplikace - gemy jsou v shared -> binarky nejsou v path
      - treba spoustet pres bundle exec
    - assety se zkompiluji do public/assets, ale nenajdou se
      - railsy pocitaji, ze je bude servovat app server, ktery assety v public
        najde, s Webrickem je treba nastavit config.serve_static_assets = true
  = 7h30

== in project ==
add gems: capistrano, capistrano-rails, capistrano-bundler, capistrano-rvm
bundle
run cap install
edit config/deploy.rb and config/deploy/<environment>.rb
create shared/config/database.yml on server (this shouldn't be in repo)

== on server (as root) ==
useradd -m -s /bin/bash -G rvm capistrano-test
passwd -l capistrano-test
rvm get stable
rvm install 2.1.1
su capistrano-test
cd
mkdir .ssh
echo '<contents of local user's .ssh/id_rsa.pub>' >> .ssh/authorized_keys
chmod 700 .ssh
chmod 600 .ssh/authorized_keys
ssh-keygen    (leave all defaults)        # generate deploy key
- add contents of deploy user's .ssh/id_rsa.pub to gitlab deploy keys
# check that git access works, also needed to add server to known_hosts
git ls-remote git@git.friendlysystems.cz:capistrano/capistrano-test.git
- create deploy directory
  root@remote $ deploy_to=/var/www/capistrano-test
  root@remote $ mkdir -p ${deploy_to}
  root@remote $ chown capistrano-test:capistrano-test ${deploy_to}
  root@remote $ umask 0002
  root@remote $ chmod g+s ${deploy_to}
  root@remote $ mkdir ${deploy_to}/{releases,shared}
- or use user's home if it's a dedicated user for the app
mkdir {releases,shared}
rvm use 2.1.1@capistrano-test --create
