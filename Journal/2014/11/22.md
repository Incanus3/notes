=== Sat, 22.11. ===

- prace - alto
  - 11.30-2
    reformatted Client

    validation of client's personal details and address is now contextual
    - sex, birth_date and all address fields are now validated only on :bakare
    - ErrorMerging.validate_associated now passes validation_context to
      associated.valid?
    - tested
      - extracted validation tests from clients_spec
      - added tests for contextual validation
      - added client factories and traits
    firstname, surname and email are now required for Client

    added email format validation to User and Client
    - added activevalidators gem and initializer

  - 2-2.45
    - zkoumani moznosti nastaveni domeny requestu v testu

  - 3.15-6
    tested hostname override in feature specs

    enclosed routes, controllers and views in namespaces
    - paths are now prefixed with /admin or /consumer
    - controllers are enclosed in Admin or Consumer modules
    - controller and view files are moved to appropriate subdirs

    changed devise prefix from accounts to auth
    used scope for custom auth routes (sign in by card)

  = 6h

[ ] opravit duplicitní chyby na klientu a uživateli - cyklická validace user-klient
    - could be uniq!ed in after_validation hook

nastavení validate: true na obou stranách asociace vede k 2násobné validaci
prvního recordu:
[3] pry(main)> client.valid?
client before validation
  user before validation
    client before validation
    client after validation
  user after validation
client after validation
=> false
[4] pry(main)> client.user.valid?
user before validation
  client before validation
    user before validation
    user after validation
  client after validation
user after validation

== Rails contextual validation ==
http://blog.arkency.com/2014/04/mastering-rails-validations-contexts/
http://blog.arkency.com/2014/05/mastering-rails-validations-objectify/
http://www.justinweiss.com/blog/2014/09/15/a-lightweight-way-to-handle-different-validation-situations/

possible soulutions:
- use contexts (supplied to validate, valid? and save)
  - since rails 4.1, validate on: supports array of contexts
  - what about passing context to nested validations?
- use validates_with for cusom validator, if the logic is too complex (may be a
  good idea and can work with multiple contexts)
  - both need to have some knowledge about the context, i.e. request host,
    provided by controller (must be set beforehand to be accessible)
- use validation wrapper (delegator / form object), that's instantiated by
  controller with record and context
