=== Fri, 23.5. ===

== RSpec ==
RSpec.configure do |config|
  config.alias_example_to :fit, :focus => true
end

= RSpec 3 news =
= core
RSpec.configure do |config|
  config.alias_example_group_to :describe_model, :type => :model
end

= expectations
expect(alphabet).to start_with("a").and end_with("z")
expect(stoplight.color).to eq("red").or eq("green").or eq("yellow")

expect(alphabet).to start_with("a") & end_with("z")
expect(stoplight.color).to eq("red") | eq("green") | eq("yellow")

s = "food"
expect { s = "barn" }.to change { s }.
  from( a_string_matching(/foo/) ).
  to( a_string_matching(/bar/) )

expect { |probe|
  "food".tap(&probe)
}.to yield_with_args( a_string_starting_with("f") )

hash = {
  :a => {
    :b => ["foo", 5],
    :c => { :d => 2.05 }
  }
}

expect(hash).to match(
  :a => {
    :b => a_collection_containing_exactly(
      an_instance_of(Fixnum),
      a_string_starting_with("f")
    ),
    :c => { :d => (a_value < 3) }
  }
)

expect([1, 3, 5]).to all( be_odd )

expect { print "foo" }.to output("foo").to_stdout
expect { print "foo" }.to output(/fo/).to_stdout
expect { warn  "bar" }.to output(/bar/).to_stderr

expect(10).to be_between(5, 10)
expect(10).not_to be_between(5, 10).exclusive
expect(10).to be_between(5, 10).inclusive

- use be_truthy and be_falsy instead of old be_true and be_false
- use be true, be false for exact matches

expect([2, 1, 3]).to contain_exactly(1, 2, 3)

- collection cardinality matchers extracted to rspec-collection_matchers
expect(list).to have(3).items
# ...can be written as:
expect(list.size).to eq(3)

expect(list).to have_at_least(3).items
# ...can be written as:
expect(list.size).to be >= 3

expect(list).to have_at_most(3).items
# ...can be written as:
expect(list.size).to be <= 3

= mocks
RSpec.configure do |config|
  config.mock_with :rspec do |mocks|
    mocks.verify_partial_doubles = true
  end
end
- will check when mocking/stubbing a method, that it actually existed
expect(MyClass).to receive(:some_message)
- or use instance_double, class_double and object_double explicitly
https://relishapp.com/rspec/rspec-mocks/v/3-0/docs/verifying-doubles

- any instance alternative implementation yields the object as first arg
allow_any_instance_of(Employee).to receive(:salary) do |employee, currency|
  usd_amount = 50_000 + (10_000 * employee.years_worked)
  currency.from_usd(usd_amount)
end

employee = Employee.find(23)
salary = employee.salary(Currency.find(:CAD))


= rails
- spec type inference from path disabled by default, enable it using
RSpec.configure do |config|
  config.infer_spec_type_from_file_location!
end

- or use metadata explicitly
RSpec.describe ThingsController, type: :controller do
  # Equivalent to being in spec/controllers
end

- mock_model and stub_model extracted into rspec-activemodel-mocks

- define methods for mock controller in controller specs
https://relishapp.com/rspec/rspec-rails/v/3-0/docs/controller-specs/anonymous-controller

== Rails ==
- smart listing - js alternative to wice_grid with inline create/edit/delete
http://showcase.sology.eu/smart_listing

- capybara element helpers
https://github.com/gsmendoza/napybara

- show logs in browser
https://github.com/dieb/browserlog

= other tools
- load environment variables from .env file (before aplication start)
https://github.com/bkeepers/dotenv
