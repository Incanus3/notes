- soucet - 4+3+8.5+3.5+5+2+2+9+3+4+3+5+5.5+4.5+5.5+4+1+5+1.5 = 79

=== Thu, 1.5. ===

- prace - alto
  - 4-5
    all orders for menu are now loaded in single query
    - updated Order
      - .for now takes optional list of meals, specifying their ids in where
      - aliased jidelak_key and client_key to meal_id and client_id
    - updated OrderGetter
      - added constructor that takes array of relevant orders
      - added instance methods that operate on this array instead of making que
        on model
    - updated MenuController
      - added day_orders which finds all orders for client and day_meals in one
        query
      - order and orders instantiates OrderGetter with day_orders and call inst
        methods on it (no additional queries)
    - updated menu views not to access order associations
    - updated specs

  - 5-8
    - snaha o upgrade na rails 4.1
      - CanteensController#edit haze 'stack level too deep' pri snaze o nalezeni
        Canteen podle id - nenalezena zadna cyklicka zavislost (validace,
        dependent, apod.)

  = 4h

=== Fri, 2.5. ===

- prace - alto
  - 7-9
    - rozbihani datastore
    - presun konfigurace db spojeni do yml configu
    - cisteni init_database/vytvor_a_napln_db.rb

  - 9-10
    - dalsi cisteni, doplneni uschovny do vytvor_a_napln

  = 3h

=== Sat, 3.5. ===

- prace - alto
  - 12-4 - rozbehnuti vsech testu
  - 4.30-7
    - pridani SimpleCov, standardizace adresarove struktury
    - odchyceni Errno::EINVAL v /log route

    extracted root route from get-values_spec
    removed database cleanup - done by DatabaseCleaner

    tested NOT FOUND and BAD REQUEST in /put-value and /delete-value

    removed unused restrict from monkeypatches
    removed duplication in routes using labmda

    tested BAD REQUEST in /bill_open

    added sk_tmp_fin, sk_tmp_pol, sk_tmp_plt to vytvor_a_napln

  - 8.15-10.15
    - dalsi testovani /bill_open

  = 8h30

=== Sun, 4.5. ===

- prace - alto
  - 3.45-4.45
    added exceptions for NotFound and BadRequest
    added common error handling to routes
    used these exceptions in bill_open
    - model shouldn't be concerned with presentation logic
    - method is aborted when exception raised - we don't need to return
      explicitly

    - zkoumani bill_put a evzova podezreleho requestu

  - 5-7.30
    added tests for /bill_put exception cases
    extracted write_bill, write_items, write_payments and write_header from
      Eskacka#bill_put
    error retvals changed to exception raises, this way they can appear in helper
      methods
    added error message to retval in BadRequest error handler

    split eskacka_spec to eskacka/bill_open_spec and eskacka/bill_put_spec

    added pending specs for untested bill_put functionality

    extracted column arrays to constants
    added write_record helper which prepairs row and then writes it to dataset

    used class << self instead of extend self since we don't include the module

    added tests for saving of items, payments and header in bill_put
    moved constants out of class << self
    added note about broken write_header

    added test for /bill_put response

  = 3h30

=== Mon, 5.5. ===

- prace - alto
  - 1-1.30, 2-3

    implemented /get-meals route which returns meals for given canteen and date
    - added tests for it
    - added Meals model with .where taking canteen_id and date
    - added ParsingHelpers which raise BadRequest if input can't be parsed
    - added Integer conversion to SpecHelpers#similar?
    - updated bin/vytvor_a_napln not to populate companies in test env
      - renamed jidelak.jidelna_firma_key to firma_key as documented

    implemented /get-meal route which renders meal by id
    - added .find(id) to Meal model
    - added tests for route

    parsing helpers now yield instead of raising BadRequst, updated routes

  - 4.15-5.15
    implemented /put_meal route - receives json-encoded meal and inserts it into
      jidelak table
    - added route
    - added Meals.create
    - added AlreadyExists exception
    - added error handler for it in routes
    - added RETVAL_ALREADY_EXISTS
    - tested
      - added date conversion to similar? helper
    - updated info page

  - 5.45-6.15
    - experimentace s show_exceptions, raise_errors a dump_errors
      - show_exceptions needs to be set to :after_handler for custom error
        handlers to work
      - if dump_errors is set to true (default), errors are dumped to log (or
        stdout) even when handled by error block

    set show_exceptions and dump_errors
    added ip to better_errors whitelist

  - 8.45-9.15

    started implementing /put_meals route
    - added route
    - added Meals.create_many
    - tested params validation

  - 10.15-11.15

    tested creation of meals by /put-meals

    /put-meals route now renders created meals
    - Meals.create_many returns dataset
    - tested
    tested case with non-existent canteen
    added pending specs for cases when meal already exists
    - what is unique about meal?

  - 12.15-12.45
    added descriptive messages to BAD REQUEST responses
    specified messages in invalid params specs
    tested cases when canteen does not exist

  - 1-1.30
    simplified meal routes using ParamsHelpers
    - added ParamsHelpers implementing fetch_param(s) and parse_param(s)
    - used in routes
    - updated expected messages in specs

  = 5h

- sequel exception hierarchy
https://github.com/jeremyevans/sequel/blob/master/lib/sequel/exceptions.rb

=== Tue, 6.5. ===

- prace - alto
  - 2.30-3
    added factory_girl gem to easily build records
    - updated spec_helper
    - used in meals_spec
    updated similar? helper to use .to_i and .to_f instead of Integer() and
      Float() since these may convert to base 8 or 16

  - 4.15-5
    split meals_spec to meals/get_routes_spec and meals/put_routes_spec
    defined factory for canteen
    fixed meal canteen to generate string meal 'numbers'
    simplified meal specs using factories
    tested that get-meals renders all meals for canteen+day and no other meals

  - 6.45-7
    - povyseni verze ruby na 2.1, pouziti keywords arguments v Meals modelu
    - aktualizace na serveru

  - 7.15-7.45
    /put_meal now ensures meal number and meal card
      number doesn't already exist for given canteen and date
    - updated Meals.create
    - added restrict to Hash monkeypatch
    - converted meal keys to symbols (otherwise Sequel complains upon find)
    - updated AlreadyExists error handler to copy error message to retval
    - tested

  = 2h

=== Wed, 7.5. ===

- prace - alto
  - 6-8
    /put-meals route now checks for meal number and
      meal card number uniqueness for given canteen, date and course
    - updated Meals.create_many
    - added Array#unique? to monkeypatches
    - tested
    - meal factory now cycles over courses

    added class << self to Meals - has many class methods

    refactored Meals model
    - extracted methods: ensure_meals_type, ensure_meals_unique, insert_all
      (moved to ModelHelpers)
    .create now checks meal type

    /put-meals now deletes existing meals for given
      canteen and date (after ensuring types and uniqueness)
    - tested

    moved check that meals is Array from Meals.create_many to /put-meals route,
      otherwise keys_to_syms makes array from hash
    added assertion to 'responds with BAD REQEUST with invalid meals'

    tested ParamsHelpers
    - fixed typo in parse_float
    removed meals tests testing that params are properly fetched and decoded

    updated info page

  = 2h

=== Thu, 8.5. ===

- prace - alto
  - 9h - praha
    - objednavky
      added foreigner gem to easily create foreign key constraints in migrations
      created foreign key constraints for all associations, moved dependent options to
        db level
      split firma table into jidelna and retezec, updated foreign keys, removed typ
        column with wrapper and validations, default scopes and after_initialize hooks
      Company is now abstract class, except_ids now done using class method - scope
        can't be used with abstract class
      updated seeds
      updated specs, removed redundant model specs (scoped uniqueness validation
        doesn't work anyway due to fkey constraints)
      reannotated models

    - datastore
      implemented /get-orders route, which renders orders for given canteen and date
      - added route
      - added Orders model with .where
      - tested, added factory for order

      implemented /get-client-orders route
      - renders orders for given canteen, client and date
      - added route
      - Meals.where now optionally restricts orders to client_id
      - tested

      implemented /put-order route
      - increases order's portions_eaten if sufficient portions remain
      - added route
      - added Orders.consume
      - tested
      - updated info page
      - commented out tables created by rails migration in vytvor_a_napln

      Orders.consume now runs in transaction

      preparation for updating client-canteen relations to N:N
      - created Canteens model
      - added notes to Clients model
      simplified param keys downcasing
      moved spec/orders/get_routes_spec to spec/orders_spec

      moved route specs to spec/routes

      fixed getting clients by canteen and client_id or card_id
      - implemented Canteens.direct_consumers
      - updated Clients.get_single and .get_multiple to use it
      - updated specs
      simplified render_to_json

      fixed (or disabled) other specs after moving to spec/routes and using schema
      generated by rails migrations (lacks pkey constraints)
      added factory for client

=== Fri, 9.5. ===

- prace - alto
  - 3h - praha - datastore - vymysleni novych rout

=== Sat, 10.5. ===

- prace - alto
  - 4h - litomerice - datastore:
    split firma table into jidelna and retezec, removed typ column
    - updated foreign keys
    - updated vytvor_a_napln
    - updated specs

    renamed /get-meal route to get /meals/:id, added get /meals route - renders all
      meals
    - tested

    disabled obsolete get-meals and put-meals routes (will be moved to canteens)
    started implementing meal update

    added get /meals and get /meals/:id routes
    - added routes
    - added Canteens.find and .all
    - tested

=== Sun, 11.5. ===

- prace - alto
  - 3h - litomerice - datastore
    extracted canteen meal routes specs from meals/get_routes and meals/put_routes
      to canteens/meals
    marked finished routes on info page
    standardized routing spec names

    split clients_spec to clients/get_spec and put_spec
    added new find routes to info page
    defined factory for chain
    got rid of resources defined in shared contexts in favor of factories

    added get /clients and get /clients/:id routes
    - added routes
    - added Clients.all and .find
    - tested
    - /get-client no longer searches by id, specs for this removed
    - marked done routes
    simplified transaction specs

    added get /chains and get /chains/:id routes
    - added routes
    - added Chains model with .all and .find
    - tested

    added get /orders and get /orders/:id routes
    - added routes
    - added .all and .find to Orders
    - tested
    marked done routes on info page

=== Mon, 12.5. ===

- prace - alto
  - 11.30-1.30
    added /canteens/:id/meals route with filtering
    - added route - shows all meals for canteen, when additional params are
      passed, they're searched and translated to column names and meals are
      filtered
    - added param helpers with !, which delete fetched params from hash
      - added parse_optional_param(!)
      - tested
    tested /clients/:id

  - 4-7
    added post /canteens/:id/meals - inserts/replaces meals for canteen and date
    - added route
    - fixed specs
    marked done routes

    added get /canteens/:id/orders, /clients/:id/orders,
      post /orders/:id/consume
    - Orders.where and joined_where allow arbitrary filtering and translate column
      names
    - added and updated specs
    - updated info page

  = 5h

=== Tue, 13.5. ===

- prace - alto
  - 3-3.30
    aliased ClientCanteen.canteen and ClientChain.chain to .company to fix
      client relations list

    - sepsani ukolu v datastore

  - 5-6
    - sepsani reportu za duben, secteni celkoveho salda

  - 6.30-7.30
    - migrace pro neobjednavkove tabulky
      - semafory - studovani, jak vytvorit DEFAULT now()
      - uschovna
      - sk_tmp_fin - stringove sloupce maji byt char, nebo varchar?

    - rozmysleni hromadneho pridani jidel, pokud uz existuji

  - 9.45-11.15
    added post /canteens - creates canteen, tested

    refactored routes by adding route_helpers
    reorganized routes

  - 11.30-1
    added post /canteens/:id - updates canteen
    - added route
    - added Canteens.update
    - tested

    refactored models by subclassing ModelBase
    - defines .all, .create, .update, .find, .where
    - expects constants Table, Columns, SingularName, ColumnNamesMapping
    - provides ensure_nonexistent as hook called by create
    - subclassed by Canteens, Chains, Clients, Meals, Orders

    added create/update routes for chains, clients and orders
    marked done routes

  = 5h30

== Saldo vyplat ==
- ke konci dubna (po dubnove vyplate) vyplaceno o 4k vice

=== Wed, 14.5. ===

- prace - alto
  - 1.45-2.15
    simplified routes using params helpers
    - added params helper - symbolized_params
    - added parsing helper - parse_json_hash_array - can be used in parse_param(s)
      - checks that param is json array of hashes - no need to check in model
    - ModelBase.ensure_hash_type renamed to ensure_columns, since type is checked
      route
    - used in routes
    - updated specs

  - 3.45-5.15
    Meals.create_many now updates existing meals if present
    - added Hash#except and #covers? to monkeypatches
    - updated create_many
    - updated specs

  - 5.15-5.45
    - code review s evzou

  - 8.15-9.15
    - problem s transakcemi - v Meals#_create_many je po zachyceni
      Sequel::DatabaseError stale DB.in_transaction? true i kdyz chyba by mela
      transakci rollbacknout
    - pricina je v DatabaseCleaneru

  - 3-4
    updated /canteens/:id/meals - existing meals are now updated instead of being
    deleted and reinserted - fixed problem with exising orders
    - only card number and name is updated - should be cheap since fkey checking
      isn't triggered

  = 4h30

=== Thu, 15.5. ===

- prace - alto
  - 12.30-3.30
    updated post /canteens/:id/meals - existing meals with course and number not
      appearing in the new list are now deleted (orders aren't updated yet)
    - updated specs

    - reseni problemu s migraci databaze na serveru

  - 4.45-7.15
    updated post /canteens/:id/meals - existing orders for meals to be deleted
    are now changed to meal with lowest number for given canteen, date and
    course
    - updated spec

    finding meals with lowest number in memory

  = 5h30

=== Fri, 16.5. ===

- prace - alto
  - 3.15-4.45
    implemented get /canteens/:id/clients route
    - lists all (direct and indirect) consumers of canteen - client columns +
      relation type
    - added Canteens#indirect_consumers, used union in consumers_for
    - tested
    - removed /get-client, /get-clients, /update-client routes and specs

  - 5-5.30
    implemented get /canteens/:id/clients/find route
    - finds canteen's consumer by columns specified in params
    /canteens/:id/clients now allows filtering by arbitrary columns
    updated specs

  - 7.30-8
    implemented get /chains/:id/clients and /chains/:id/clients/find
    - added routes
    - added Chains.consumers_for, .find_consumer, .consumers_where
    - tested

  - 8.30-10
    implemented get /clients/:id/canteens route
    - lists client's canteens (direct and indirect) including relation type
    - added route
    - added Clients.canteens_for, .find_canteen, .canteens_where
    - tested

    implemented get /clients/:id/chains route
    - lists client's chains including relation type, allows filtering
    - added route
    - added Clients.chains_for, .find_chain, .chains_where
    - tested

    implemented get /canteens/:id/chains route
    - lists canteen's chains
    - added route
    - added Canteens.chains_for, .find_chain, .chains_where
    - tested

    implemented get /chains/:id/canteens route
    - lists chain's canteens, allows for filtering
    - added route
    - added Chains.canteens_for, .find_canteen, .canteens_where
    - tested

  = 4h

=== Sun, 18.5. ===

- prace - alto
  - 2-3 - vytvoreni transakci pro sk_tmp_fin, sk_tmp_pol, sk_tmp_plt

  = 1h

=== Mon, 19.5. ===

- prace - alto
  - 5-6.30
    - extrakce migraci z objednavek do extra repa
    - vlozeni do objednavek a datastore jako submodule
    - vytvoreni skriptu pro spusteni migraci z datastore

  - 6.30-9
    - vytvoreni Rakefile, ktery umi spoustet databazove tasky prevzate z
      active_record a mockuje Rails

  - 12-1
    - pridani tasku na db:seed
    - presun 'vytvor' veci z vytvor_a_napln do db/seed.rb

  = 5h

=== Thu, 22.5. ===

- prace - alto
  - 3-4.30
    - reseni bugu v insertu jidel

  = 1h30
