=== Sat, 19.4. ===

- prace - alto
  - 5.30-6, 6.15-6.45
    split client_firma_join in two tables - client_jidlena_join and
      client_retezec_join
    - added migrations
    - ClientCompany is now abstract class
    - removed default scopes from ClientCanteen and ClientChain, querying is no
      much more efficient
    ClientRelationsController#remove_relation is now handled by two actions -
      remove_canteen and remove_chain
    - updated routes
    - updated specs

  - 6.45-7, 7.30-7.45
    - vymysleni Client::Relation API

  - 7.45-9
    extracted presentation logic from Client::Relation to RelationPresenter
    - used in CurrentCanteenController, ClientsHelper, canteen_selector
    - updated specs
    updated notes about new Client::Relation API

  - 9-9.30
    - analyza queries pri nacteni single portion menu

  - 9.30-10
    MenusController loads all meals in one query

  - 10-10.30
    extracted relation-finding logic from Client
      to Client::Relation
    - updated ClientAuth and SessionsController
    - updated specs

  - 11.30-11.45
    renamed Client::Relation to ClientCanteenRelation
    - updated ClientAuth, StoredRelation, SessionsController
    - updated specs

  - 11.45-12.15,1.30-2
    started implementing login by card for indirect
      relation between client and canteen (disabled for now)
    - Client#add_canteen_relation and #add_chain_relation now uses
      find_or_create_by! instead of create
    - added Chain#add_canteen (uses find_or_create_by!)
    - added ClientCanteenRelation#create which creates direct or indirect relation
      depending on whether chain was supplied
    - wrap_attribute no longer hides the original attribute since this makes
      create not work with direct column specification, making find_or_create_by
      unusable
    - updated specs

  - 2.30-2.45
    tested Client#add_canteen_relation and #add_chain_relation
    - they now raise RelationWithDifferentTypeExists appropriately

  - 2.45-3
    tested Client#remove_canteen_relation and #remove_chain_relation
    - they now raise RelationDoesNotExist appropriately

  - 3-3.30
    - tried other edge cases when using add_canteen|chain_relation, added notes

  = 6h30

- Canteen a Chain maji stale default_scope, idealni by bylo rozdelit i je do
  dvou tabulek

== ActiveRecord ==
- ActiveRecord.find_by raises StatementInvalid - no such column <assoc name>
  when given non-AR param as association - should be fixed in upstream
class User < ActiveRecord::Base
  belongs_to :client
end

Client.find_by(client: nil)

== 15 queries pri nacteni menu - single i multiple ==
- uzivatel - v user podle id v session
- klient - v client podle user.client_id
- direct_canteen_relations klienta
	- prime vztahy - v client_jidelna_join podle id klienta
  - jidelny - ve firma podle firma_key vztahu (zbytecny where na vyber jidelen)
- indirect_canteen_relations klienta
	- vztahy s retezci - v client_retezec_join podle id klienta
	- retezce - ve firma podle firma_key vztahu (zbytecny where na vyber retezcu) - k cemu je vubec tenhle select?
  - vztahy retezcu s jidelnami - v jidelna_retezec_join podle id retezcu
  - jidelny - ve firma podle jidelna_firma_key vztahu
- snidane
	- jidla - snidane na dany den v dane jidelne
  - objednavky - objednavky klienta na tato jidla
- obedy - totez
- vecere - totez - jidla na dany den by se mela vyhledat najednou, pak je rozdelit na snidane, obedy a vecere
+ dotaz na vsechna jidla jidelny na dany den (nejpomalejsi) - proc?
